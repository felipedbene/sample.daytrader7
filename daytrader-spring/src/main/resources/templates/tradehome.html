<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/main}">
<head>
    <title>Trade Home</title>
</head>
<body>
<div layout:fragment="content">
    <h2 style="margin-bottom: 1rem;">
        Welcome back, <span th:text="${account.profileID}">user</span>
    </h2>

    <!-- Key metrics cards -->
    <div class="dashboard-grid">
        <!-- Cash Balance -->
        <div class="card">
            <div class="card-header">
                <span class="card-title">Cash Balance</span>
            </div>
            <div class="card-value" th:text="'$' + ${#numbers.formatDecimal(account.balance, 1, 'COMMA', 2, 'POINT')}">$0.00</div>
            <div class="card-subtitle" th:text="'Opening: $' + ${#numbers.formatDecimal(account.openBalance, 1, 'COMMA', 2, 'POINT')}">Opening: $0.00</div>
        </div>

        <!-- Holdings Value -->
        <div class="card">
            <div class="card-header">
                <span class="card-title">Holdings Value</span>
                <span class="card-subtitle" th:text="${holdingsCount} + ' positions'">0 positions</span>
            </div>
            <div class="card-value" th:text="'$' + ${#numbers.formatDecimal(holdingsTotal, 1, 'COMMA', 2, 'POINT')}">$0.00</div>
        </div>

        <!-- Gain/Loss -->
        <div class="card">
            <div class="card-header">
                <span class="card-title">Gain / Loss</span>
            </div>
            <div th:class="${gain.doubleValue() >= 0 ? 'card-value positive' : 'card-value negative'}"
                 th:text="'$' + ${#numbers.formatDecimal(gain, 1, 'COMMA', 2, 'POINT')}">$0.00</div>
            <span th:class="${gainPercent.doubleValue() >= 0 ? 'stat-badge positive' : 'stat-badge negative'}"
                  th:text="${#numbers.formatDecimal(gainPercent, 1, 'COMMA', 2, 'POINT')} + '%'">0%</span>
        </div>

        <!-- Account Info -->
        <div class="card">
            <div class="card-header">
                <span class="card-title">Account</span>
            </div>
            <div style="font-size: 0.9rem; color: var(--text-muted); line-height: 1.8;">
                <div>ID: <strong style="color: var(--text-heading);" th:text="${account.accountID}">0</strong></div>
                <div>Created: <span th:text="${#temporals.format(account.creationDate, 'MMM dd, yyyy h:mm a')}">-</span></div>
                <div>Logins: <span th:text="${account.loginCount}">0</span></div>
            </div>
        </div>
    </div>

    <!-- Quick Trade -->
    <div class="card card-wide" style="margin-bottom: 1rem;">
        <div class="card-header">
            <span class="card-title">Quick Trade</span>
        </div>
        <form th:action="@{/quote}" method="get" class="form-inline" style="max-width:none;">
            <div class="form-group" style="margin-bottom:0;">
                <input type="text" name="symbols" placeholder="Enter symbol (e.g. s:0, s:1)"
                       style="min-width: 200px;">
            </div>
            <button type="submit" class="btn btn-primary">Get Quote</button>
        </form>
    </div>

    <!-- Recent Orders -->
    <div class="card card-wide">
        <div class="card-header">
            <span class="card-title">Recent Orders</span>
            <a th:href="@{/account}" class="btn btn-small btn-secondary">View All</a>
        </div>
        <table th:if="${!#lists.isEmpty(recentOrders)}" class="data-table">
            <thead>
                <tr>
                    <th>Type</th>
                    <th>Symbol</th>
                    <th>Qty</th>
                    <th>Price</th>
                    <th>Status</th>
                    <th>Date</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="o : ${recentOrders}">
                    <td th:class="${o.orderType == 'buy' ? 'positive' : 'negative'}"
                        th:text="${o.orderType}">buy</td>
                    <td th:text="${o.symbol}">s:0</td>
                    <td th:text="${#numbers.formatInteger(o.quantity, 1, 'COMMA')}">0</td>
                    <td th:text="'$' + ${#numbers.formatDecimal(o.price, 1, 'COMMA', 2, 'POINT')}">$0</td>
                    <td th:text="${o.orderStatus}">open</td>
                    <td th:text="${#temporals.format(o.openDate, 'MMM dd, yyyy h:mm a')}">-</td>
                </tr>
            </tbody>
        </table>
        <p th:if="${#lists.isEmpty(recentOrders)}" style="color: var(--text-muted);">No orders yet. Start trading!</p>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions" style="margin-top: 1.5rem;">
        <a th:href="@{/portfolio}" class="btn btn-primary">View Portfolio</a>
        <a th:href="@{/quote}" class="btn btn-secondary">Browse Quotes</a>
        <a th:href="@{/account}" class="btn btn-secondary">Account Details</a>
    </div>
</div>

<div layout:fragment="scripts">
    <script th:src="@{/js/market-summary-ws.js}"></script>
</div>
</body>
</html>
